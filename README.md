# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Общая архитектура

Приложение построено с использованием событийно-ориентированной архитектуры и частично придерживается принципов MVC (Model-View-Controller), но с некоторыми особенностями.

Model — объекты данных и бизнес-логика (ProductsData, BasketData, AppState).

View — UI-компоненты, отвечающие за визуальное отображение (Card, Basket, Page, Modal, формы).

Controller — связующее звено между Model и View реализовано через событие EventEmitter.

## Паттерны проектирования

Компонент (Component)

Все визуальные элементы наследуются от базового класса Component.
Компоненты имеют методы рендера, обновления данных и обработку событий.

## Управление состоянием (State Management)

Классы ProductsData, BasketData, AppState — это хранилища состояния.
Они управляют внутренним состоянием и эмитят события при изменении, что триггерит обновление UI.

## Формы (Form и производные)

Абстракция для работы с формами (DataPayment, DataContacts).
Управление валидацией, изменением полей и отправкой событий — это часть паттерна Presentation Model.
Отделение логики формы от DOM.

## Модальное окно (Modal)

Универсальный компонент для показа динамического контента.
Управляется через методы show/hide и реакцию на клики.
Этот компонент можно рассматривать как Controller для модального UI.

## Flow данных и событий

Данные загружаются через API → сохраняются в ProductsData.
Изменения в данных вызывают событие, на которое подписан UI (CardsContainer, Basket и др.).
Пользовательские действия (клики, формы) вызывают события через EventEmitter.
На события реагируют слушатели, обновляя данные и UI.

## Краткий обзор структуры:

API: Api + AppApi для общения с сервером.

Данные:
ProductsData — хранит каталог товаров.
BasketData — состояние корзины.
AppState — состояние заказа (оплата и контакты).

UI-компоненты:
Page — общий контейнер страницы и хедер.
CardsContainer — рендерит список карточек.
Card — отображает отдельный товар в разных режимах.
Basket — отображение корзины.
Modal — универсальное модальное окно.
DataPayment, DataContacts — формы оплаты и контактов.
Success — экран успешного оформления заказа.

## API-слой

Классы:

Api — базовый класс для работы с HTTP-запросами (GET, POST).
AppApi — расширяет Api, реализует конкретные методы для получения списка товаров и отправки заказов.

Назначение:
Абстрагировать взаимодействие с сервером, чтобы можно было удобно запрашивать данные и отправлять форму заказа.

## Данные

ProductsData — данные каталога товаров

Что хранит:
Массив товаров (productList).
ID текущего выбранного товара для предпросмотра (currentPreviewId).

Методы:
items — геттер и сеттер для списка товаров, при обновлении выбрасывает событие catalog:changed.
getProduct(id) — получение товара по ID, если товар не найден — выбрасывает ошибку.
preview — управление ID товара, который показывается в предпросмотре, с проверкой наличия товара.

События:
catalog:changed — обновление списка товаров.
card:selected — выбран конкретный товар.

BasketData — данные корзины

Что хранит:
Список товаров в корзине.

Методы:
Добавление и удаление товара (с проверками дубликатов и отсутствия).
Подсчет итоговой суммы.
Сброс корзины.

События:
basket:changed — изменение содержимого корзины.

## UI-компоненты

Card — карточка товара

Отвечает за:
Отрисовку информации о товаре (название, описание, цена, категория, картинка).
Обработку кликов: добавление в корзину, удаление из корзины, открытие предпросмотра.
Изменение состояния кнопки «Добавить» — меняется на «Удалить» если товар уже в корзине.

Особенности:
Использует классы для стилизации по категории товара.
Использует события card:add, card:delete, card:select для взаимодействия с бизнес-логикой.

CardsContainer — контейнер карточек

Отвечает за отображение коллекции карточек товаров.

Basket — визуализация корзины

Отображает список товаров в корзине с их порядковыми номерами и суммарной стоимостью.

Page — корневой контейнер страницы

Управляет отображением счётчика товаров в корзине.

Блокирует взаимодействие со страницей при открытом модальном окне (locked).

Modal — модальное окно

Отвечает за открытие и закрытие модальных окон.
Позволяет вставлять любой HTML-контент (карточки, корзина, формы).

Формы (DataPayment, DataContacts)

Расширяют базовый класс Form.
Управляют конкретными полями ввода, валидацией, обработкой событий ввода и сабмита.

Success — экран успешного оформления заказа

Отображает сообщение об успешной оплате.
Имеет кнопку закрытия, которая сбрасывает состояние заказа.

## Логика приложения (app.ts)

Инициализация:

Создаются экземпляры компонентов: 

данные (ProductsData, BasketData, AppState), UI (Page, Modal, CardsContainer, Basket, формы, Success).
Создается центральный EventEmitter для связи.

Загрузка и отображение товаров:

Запрос товаров с сервера (appApi.getCards()).
При обновлении товаров (событие catalog:changed) происходит рендер карточек в галерее.

Работа с карточками:

При клике на карточку открывается модальное окно с подробной информацией.
Кнопка «Добавить»/«Удалить» меняет состояние корзины.

Корзина:

Событие basket:open открывает модальное окно с содержимым корзины.
Обновление корзины (событие basket:changed) обновляет UI корзины, суммарную стоимость и счетчик.

Формы оплаты и контактов:

Переходы между этапами оформления заказа через события и рендер форм в модалке.
Валидация форм, отображение ошибок.
Сбор и обновление состояния заказа.

Завершение заказа:

Отправка данных заказа на сервер.
При успехе — показ экрана успеха, сброс корзины и состояния заказа.

Блокировка страницы:

При открытии модального окна страница блокируется, чтобы предотвратить взаимодействие с основным содержимым.

## Итог

Данные и бизнес-логика (ProductsData, BasketData, AppState)

UI-компоненты (Card, CardsContainer, Basket, Modal, Page, Success, Forms)

Связь между слоями через события (EventEmitter)

Асинхронный API-вызов (AppApi, Api)